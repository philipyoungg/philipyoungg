//     ____  __    _ ___          __  __                        
//    / __ \/ /_  (_) (_)___      \ \/ /___  __  ______  ____ _ 
//   / /_/ / __ \/ / / / __ \      \  / __ \/ / / / __ \/ __ `/ 
//  / ____/ / / / / / / /_/ /      / / /_/ / /_/ / / / / /_/ /  
// /_/   /_/ /_/_/_/_/ .___/      /_/\____/\__,_/_/ /_/\__, /   
//                  /_/                               /____/    
// ------------------------------------------------------------ 
//       Product Design & Developement - philipyoungg.com       
// ------------------------------------------------------------ 

- var shareTitle = title + " - Philip Young" || "Philip Young"
- var shareImage = '/screenshot.png'
- var shareDescription = description || 'Philip Young is a product designer from Jakarta, Indonesia. Currently working as Product Lead Design at Bukapintu.co'

doctype html
html(lang='en')
  head
    title=shareTitle
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no')
    meta(name="google-site-verification" content="8_jk4EKPuEDASp4cmS5SgZSNYpl-RxRyaJPO9jF5Pq8")
    meta(name='author' content='Philip Young')
    meta(name='author-website' content='philipyoungg.com')
    link(href='https://fonts.googleapis.com/css?family=Poppins:400,600,700|Inconsolata:400,700', rel='stylesheet')
    link(href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/instafeed.js/1.4.1/instafeed.min.js')
    script(src='https://cdn.rawgit.com/philipyoungg/external-link-to-new-tab/master/externalLinkToNewTab.min.js')
    link(rel='stylesheet' href='https://cdn.rawgit.com/philipyoungg/external-link-to-new-tab/master/externalLinkToNewTab.css')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/tachyons/4.6.2/tachyons.css')
    link(rel="stylesheet", href="/reset.css")
    link(rel="stylesheet", href="/main.css")
    link(ref='icon' href='/favicon.ico?' type='image/x-icon')
    meta(property='og:title', content=shareTitle)
    meta(property='og:type', content='website')
    meta(property='og:image', content=shareImage)
    meta(property='og:description', content=shareDescription)
    meta(name='twitter:card', content='summary')
    meta(name='twitter:site', content='@philipyoungg')
    meta(name='twitter:creator', content='@philipyoungg')
    meta(name='twitter:title', content=shareTitle)
    meta(name='twitter:description', content=shareDescription)
    meta(name='twitter:image', content=shareImage)
    meta(name="description" content=shareDescription)
    script(src='https://cdnjs.cloudflare.com/ajax/libs/history.js/1.8/native.history.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.0/jquery.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js')
  body.lh-copy.bg-mint
    // grid
    .fixed.cf.ph2.ph3-m.ph5-ns.w-100.vh-100.absolute-horizontal-center.grid(style='pointer-events: none')
      .fl.w-50.w-third-m.replace.w-25-ns.ph2.ph3-ns.h-100
        .bl.b--black-05.h-100
      .fl.w-50.w-third-m.replace.w-25-ns.ph2.ph3-ns.h-100
        .bl.b--black-05.h-100
      .fl.w-50.w-third-m.replace.w-25-ns.ph2.ph3-ns.h-100
        .bl.b--black-05.h-100
      .fl.w-50.w-third-m.replace.w-25-ns.ph2.ph3-ns.h-100.br.b--black-05
        .bl.b--black-05.h-100
    .vs-section.pt4.pt5-m.pt6-ns
      #app.o-0
        if (current.path[0] !== 'thoughts') 
          !=yield
        else
          .cf.center.ph2.ph3-m.ph5-ns.grid
            .fl.w-100.w-100-m.w-25-ns.ph2.ph3-ns.mb3.mb4-m.mb0-ns
              h3.f5.b.mb1 Navigation
              != partial('_shared/nav')
            .fl.w-100.w-100-m.w-75-ns.ph2.ph3-ns.wow.fadeInUp
                h1.f3.f1-m.f-subheadline-ns.poppins.tracked-tight.mb4.mb5-ns
                  =current.path[1] === 'index' ? 'Thoughts' : title
          if (current.path[1] !== 'index')
            .cf.center.ph2.ph3-m.ph5-ns.grid.wow.fadeInUp
              .fl.w-100.w-100-m.w-25-ns.ph2.ph3-ns.h1.dn-m
              article.fl.w-100.w-100-m.w-75-ns.ph2.ph3-ns.mb4.mb5-ns.measure-wide
                !=yield
            !=partial('_shared/subscribe')
            .cf.ph3.ph4-m.ph5-ns.center.grid.mb4.mb5-ns.wow.fadeInUp
              .fl.w-100.w-25-ns.dn.dn-m.db.h1
              .fl.w-100.w-67-m.w-50-ns.ph2.ph3-ns.pv4
                #disqus_thread
          !=partial('_shared/blog-excerpt')
        .pt6
          !=partial('_shared/footer')
    script(src='/tracker.js')

    script.
      // Google Analytics
      // =======================================
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-51658519-1', 'auto');
      ga('send', 'pageview');
                                
      var updateScript = function() {
        externalLinkToNewTab()
        var urlArray = window.location.href.split('/')
        if (urlArray[3] === 'thoughts' && urlArray[4]) {
          if (window.DISQUS) {
            DISQUS.reset({
              reload: true,
              config: function() {
                this.page.identifier = window.location.href
                this.page.url = window.location.href
              }
            })
          } else {
            var disqus_config = function () {
              this.page.url = window.location.href
              this.page.identifier = window.location.href
            };
            (function() { // DON'T EDIT BELOW THIS LINE
              var d = document, s = d.createElement('script');
              s.src = 'https://philipyoungg.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
            })();
          }  
        }
      }
      
      var splitWord = function(selector) {
        var title = document.querySelector(selector);
        title.style['whiteSpace'] = 'pre-wrap';
        title.style['opacity'] = 0;
        var words = title.textContent.split(' ')
        title.textContent = ''
        title.style['opacity'] = 1
        words.forEach(function(word){
          var span = document.createElement('span')
          var space = document.createElement('span')
          span.style['display'] = 'inline-block'
          span.style['opacity'] = 0
          span.textContent = word
          space.textContent = ' '
          title.appendChild(span)
          title.appendChild(space)
        })
      }
        
      function playAnimation() {
        splitWord('h1')
        var loadingIn = anime.timeline({
          autoplay: false
        })
          .add({
            targets: '#app',
            easing: 'easeInOutQuad',
            opacity: [0, 1],
            translateX: [-10, 0],
            duration: 300,
          });
          
        var title = {
          targets: 'h1 span',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateY: [2, 0],
          duration: 500,
          delay: function(t, i) {
            return i * 50
          }
        }
        
        var article = {
          targets: 'article',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateX: [-10, 0],
          duration: 500,
          offset: 0
        }
          
        var books = {
          targets: '.book',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateX: [-10, 0],
          duration: 500,
          delay: function(t, i) {
            return i * 50
          },
          offset: 0
        }
        
        var thoughts = {
          targets: '.thoughts',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateX: [-10, 0],
          duration: 500,
          delay: function(t, i) {
            return i * 50
          },
          offset: 0
        }
        
        var intro = {
          targets: '.intro',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateX: [-10, 0],
          duration: function(t, i) {
            return 500
          },
          delay: function(t, i) {
            return i * 50
          },
          offset: 0
        }
        
        var inquiry = {
          targets: '.inquiry',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateX: [-10, 0],
          duration: 500,
          offset: 0
        }
        
        var disclaimer = {
          targets: '.disclaimer',
          easing: 'easeInOutQuad',
          opacity: [0, 0.7],
          translateY: [5, 0],
          duration: 300,
          offset: 300
        }
        
        var label = {
          targets: 'label',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateX: [-10, 0],
          duration: 500,
          delay: function(t, i) {
            return i * 50
          },
          offset: 10
        }
        
        var input = {
          targets: '.input-reset',
          easing: 'easeInOutQuad',
          opacity: [0, 1],
          translateX: [-10, 0],
          duration: 500,
          delay: function(t, i) {
            return i * 50
          },
          offset: 0
        }
        
        var page = anime.timeline({
          autoplay: false,
        })
          .add(title)
          .add(books)
          .add(intro)
          .add(thoughts)
          .add(article)
          .add(input)
          .add(label)
          .add(inquiry)
          .add(disclaimer)
          
        setTimeout(function(){
          loadingIn.play()
          page.play()
        }, 1)
      }
      
      var cacheCurrentPage = function() {
        var newContent = $('#app').html()
        pageCache[window.location.href] = {}
        pageCache[window.location.href].html = newContent
        pageCache[window.location.href].title = document.title
      }
      
      var pageCache = {}
      cacheCurrentPage()
      
      var updateView = function(state) {
        window.scrollTo(0, 0)
        document.title = pageCache[state.url].title
        $('#app')
          .html(pageCache[state.url].html)
          .promise()
          .done(function(res){
            $('.disclaimer').css({
              opacity: 0
            })
            $('.book').css({
              opacity: 0
            })
            $('.disclaimer').css({
              opacity: 0
            })
            $('.intro').css({
              opacity: 0
            })
            $('.thoughts').css({
              opacity: 0
            })
            $('article').css({
              opacity: 0
            })
            $('.inquiry').css({
              opacity: 0
            })
            $('.disclaimer').css({
              opacity: 0
            })
            playAnimation()
            updateScript()
            ga('set', {
              page: window.location.pathname,
              title: pageCache[state.url].title,
            })
            ga('send', 'pageview')
          })
        ///////////
      }
      
      $('#app').on('click', 'a', function(e){
        if (this.hostname !== window.location.hostname) {
          return
        }
        e.preventDefault()
        if (window.location.href === this.href) {
          return
        }
        if (this.href) {
          var loadingOut = anime.timeline({
            autoplay: false
          })
            .add({
              targets: '#app',
              easing: 'easeInOutQuad',
              opacity: [1, 0],
              translateX: [0, 10],
              duration: 200,
            })
          loadingOut.play()
          History.pushState( null, 'loading...', this.href )
        } 
      })
      
      History.Adapter.bind(window, 'statechange', function(){
        var state = History.getState()
        if (!pageCache[state.url]) {
          $.get(state.url, function(res){
            var newContent = $(res).find('#app').html()
            var newTitle = $(res).filter('title').text()
            pageCache[state.url] = {}
            pageCache[state.url].html = newContent
            pageCache[state.url].title = newTitle
          })
          .promise()
          .done(function(res){
            updateView(state)
          })
          .fail(function(res){
            window.location.href = '/404'
          })
        } else {
          setTimeout(function(){
            updateView(state) // super animation hack
          }, 200)
        }
      })
      
      setTimeout(playAnimation, 400)
      updateScript()
      
